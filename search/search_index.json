{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":"<p>Welcome to my private snippets collection. My name is Alex and I work as a software developer. </p> <p>Because I find myself having to do the same things over and over again, it made sense to take notes. After sharing my notes with more and more friends and colleagues, I thought why not take it a step further and publish them on GitHub.</p> <p>Maybe someone else will find something useful or can even contribute or give feedback.</p>"},{"location":"traefik/","title":"Traefik","text":"<p>I love Traefik. Here are some of my snippets.</p>"},{"location":"traefik/#add-trailing-slash-to-url","title":"Add trailing slash to URL (/)","text":"<p>For some raeson your service requires a trailing slash in order to work. However, for a better user experience you want to drop this requirement. This can be done by using:</p> <pre><code>http:\n  middlewares:\n    slashRedirect:\n      redirectRegex:\n        regex: '^(https?://.*[^/]+/[a-z0-9_-]+)$'\n        replacement: '${1}/'\n        permanent: true\n</code></pre> <p>This will automatically redirect <code>https://example.com/foo</code> to <code>https://exmaple.com/foo/</code>.</p> <p>Note</p> <p>Keep in mind, that RegEx is expensive. Therefore, we will set <code>permanent</code> to  <code>true</code> to return with a response code <code>301</code> instead of <code>302</code> so the browser may cache it.</p> <p>Tip</p> <p>For other RegEx examples visit the RegEx101.com playground.</p>"},{"location":"traefik/#headers","title":"Headers","text":""},{"location":"traefik/#remove-response-header","title":"Remove response header","text":"<p>Some times you might need to remove a header from the response. In this example we want to remove the <code>Set-Cookie</code> header.  This can simply be done be repleacing it with an empty string:</p> <pre><code>http:\n  middlewares:\n    removeCookie:\n      headers:\n        customResponseHeaders:\n          set-cookie: \"\"\n</code></pre>"},{"location":"traefik/#add-response-header-to-every-request-via-entrypoint","title":"Add Response Header to every Request via Entrypoint","text":"<p>Let's say we have a dynamic middleware called <code>hostname</code>:</p> <pre><code>http:\n  middlewares:\n    hostname:\n      headers:\n        customResponseHeaders:\n          x-proxy: \"foo.example.com\"\n</code></pre> <p>In order to a apply the <code>hostname</code> middleware to all our respones without adding it to every router, we may apply to direct to our entrypoint <code>web</code> at port <code>80</code>:</p> <pre><code>services:\n  traefik:\n    command:\n      ...\n      - \"--entrypoints.web.address=:80\"\n      - \"--entrypoints.web.http.middlewares=hostname@file\"\n</code></pre>"},{"location":"traefik/#query-parameters","title":"Query Parameters","text":""},{"location":"traefik/#removing-a-query-parameter","title":"Removing a Query Parameter","text":"<p>To remove a parameter named <code>_pat</code> this can be done by using the redirectRegex middleware:</p> <pre><code>http:\n  middlewares:\n    remove-parameter:\n      redirectRegex:\n        regex: \"^(.+)(_pat=\\\\w+)(.*)\"\n        replacement: \"${1}${3}\"\n</code></pre> <p>Warn</p> <p>This causes an additional redirect, which negatively affects the overall performance of your application. Major search engines will downgrade your search ranking, as this is considered a poor user experience.</p>"},{"location":"traefik/#mitmproxy","title":"mitmproxy","text":"<p>Here is how to add mitproxy to your app. Let's say we have a service running at <code>example.com:8000</code>.</p> <pre><code>services:\n  mitmweb:\n    image: mitmproxy/mitmproxy:9.0.1\n    tty: true\n    command: mitmweb --web-host 0.0.0.0 --mode reverse:http://example.com:8000\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.proxy-ui.rule=Host(`proxy.example.com`)\"\n      - \"traefik.http.routers.proxy-ui.service=proxy-ui\"\n      - \"traefik.http.services.proxy-ui.loadbalancer.server.port=8081\"\n      - \"traefik.http.services.proxy-ui.loadbalancer.passHostHeader=false\"\n      - \"traefik.http.routers.proxy-ui.middlewares=mitmproxy-header\"\n      - \"traefik.http.routers.proxy.rule=Host(`example.com`)\"\n      - \"traefik.http.routers.proxy.service=proxy\"\n      - \"traefik.http.services.proxy.loadbalancer.server.port=8000\"\n      - \"traefik.http.middlewares.mitmproxy-header.headers.customrequestheaders.Origin=\"\n      - \"traefik.http.middlewares.mitmproxy-header.headers.customresponseheaders.X-Content-Type-Options=\"\n    networks:\n      - traefik\n</code></pre> <p>This will launch the proxy which can be accessed from <code>exmaple.com</code>. The mitmproxy web UI can be accessed by <code>proxy.example.com</code>.</p>"}]}